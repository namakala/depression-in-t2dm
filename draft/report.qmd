---
author: Aly Lamuri
title: Meta-Analysis on Selected Articles
format:
  pdf:
    keep-tex: true
    number-sections: true
bibliography: ref.bib
knitr:
  opts_chunk:
    echo: false
    error: false
    warning: false
    message: false
    fig.width: 10
    fig.height: 8
    comment: "|"
header-includes:
- \usepackage{typearea}
---

```{r init}

pkgs <- c("magrittr", "targets", "kableExtra")
pkgs_load <- sapply(pkgs, library, character.only = TRUE)

options(digits = 2)

report_bias <- function(bias) {
  res <- bias %>%
    subset(select = -c(tau, Rb)) %>%
    kable(booktabs = TRUE, longtable = TRUE, escape = FALSE, col.names = c(
      "Label", "N", "$\\beta$", "SE", "$p$", "$I^2$", "$H^2$", "$\\tau^2$"
    )) %>%
    add_header_above(c(" " = 2, "Egger's test" = 3, "Heterogeneity [95% CI]" = 3)) %>%
    kable_styling(font_size = 7, latex_options = c("repeat_header"))

  return(res)
}

report_meta <- function(meta) {
  sub_meta <- meta %>% subset(!.$Exclude, select = -c(Exclude))
  to_bold  <- sub_meta %>% {which(.$Author %in% c("Random", "Fixed"))}
  to_color <- sub_meta %>% {which(.$Author == "Prediction")}
  res <- sub_meta %>%
    kable(booktabs = TRUE, longtable = TRUE) %>%
    add_header_above(c(" " = 3, "Prevalence" = 4, "Weight (%)" = 2)) %>%
    row_spec(to_bold, bold = TRUE) %>%
    row_spec(to_color, bold = TRUE, background = "#D8DEE9") %>%
    kable_styling(font_size = 7, latex_options = c("repeat_header"))

  return(res)
}

```

# Executive Summary

- Effect size was pooled using the raw proportion without transformation
- Outliers were identified for reported studies which 95% CI is beyond the pooled confidence interval
- Outliers were removed in favor of improving the homogeneity, as reflected by I^2^ and prediction interval
- Random effect model is used for all meta-analysis procedure

{{< pagebreak >}}

# Re-analyzing Previous Publications

```{r tbl-bias-author}
#| tbl-cap: Bias and heterogeneity in included reviews

tar_read(bias_author) %>% report_bias()

```

```{r tbl-meta-author}
#| tbl-cap: Re-analysis of all included reviews

tar_read(meta_author) %>% report_meta()

```

{{< pagebreak >}}

# Exploratory Data Analysis

## Grouped by year

```{r tbl-bias-year}

tar_load(bias_eda)
bias_eda$year %>% report_bias()

```

```{r tbl-meta-year}

tar_load(meta_eda)
meta_eda$year %>% report_meta()

```

## Grouped by country

```{r tbl-bias-country}

tar_load(bias_eda)
bias_eda$clean_country %>% report_bias()

```

```{r tbl-meta-country}

tar_load(meta_eda)
meta_eda$clean_country %>% report_meta()

```

## Grouped by criteria

```{r tbl-bias-criteria}

tar_load(bias_eda)
bias_eda$clean_criteria %>% report_bias()

```

```{r tbl-meta-criteria}

tar_load(meta_eda)
meta_eda$clean_criteria %>% report_meta()

```

\newpage
\KOMAoptions{paper=landscape,pagesize}
\recalctypearea

## Grouped by instrument

```{r tbl-bias-instrument}

tar_load(bias_eda)
bias_eda$clean_instrument %>% report_bias()

```

```{r tbl-meta-instrument}

tar_load(meta_eda)
meta_eda$clean_instrument %>% report_meta()

```

\newpage
\KOMAoptions{paper=portrait,pagesize}
\recalctypearea

